<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meta Ads Performance Dashboard</title>
    <!-- Version: 2.4.0 - YAML indentation fixed! - Sep 12 2025 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%232563eb'/><rect x='20' y='55' width='15' height='30' rx='3' fill='white'/><rect x='42' y='25' width='15' height='60' rx='3' fill='white'/><rect x='64' y='40' width='15' height='45' rx='3' fill='white'/></svg>">
    <link rel="stylesheet" href="css/dashboard-saas.css">
    <!-- Data adapter and SaaS loader -->
    <script src="data_adapter.js"></script>
    <script src="data_loader_saas.js?v=2.1.0"></script>
    <!-- i18n support -->
    <script src="i18n/i18n.js"></script>
</head>
<body>
    <!-- ‚è≥ Loading Overlay -->
    <div id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">Conectando con tus datos...</div>
        <div class="loading-subtext" id="loading-subtext">Esto puede tomar unos segundos</div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loading-progress-bar"></div>
        </div>
    </div>

    <!-- üÜï First-time User Overlay with Video (Wait Marketing) -->
    <div id="firstload-overlay">
        <div class="firstload-content">
            <div class="firstload-title" id="firstload-title">¬°Bienvenido! üéâ</div>
            <div class="firstload-subtitle" id="firstload-subtitle">Mientras preparamos tus datos, aprende a usar el dashboard</div>

            <!-- Video Container - src is set dynamically by showDataPendingUI() to prevent autoplay on every page load -->
            <div class="firstload-video-container" id="firstload-video-container">
                <iframe
                    id="firstload-video"
                    data-src="https://www.loom.com/embed/4ecbc5cb11144dec931d5285a6e70cb7?autoplay=1&hide_owner=true&hide_share=true&hide_title=true"
                    frameborder="0"
                    webkitallowfullscreen
                    mozallowfullscreen
                    allowfullscreen
                    allow="autoplay"
                ></iframe>
            </div>

            <!-- Progress Section -->
            <div class="firstload-progress-section">
                <div class="firstload-progress">
                    <div class="firstload-progress-bar" id="firstload-progress-bar"></div>
                </div>
                <div class="firstload-text" id="firstload-text">Conectando con Meta Ads...</div>
            </div>

            <!-- Skip Button (visible during loading) -->
            <button class="firstload-skip-btn" id="firstload-skip-btn" style="display: none;">
                Saltar video ‚è≠Ô∏è
            </button>

            <!-- Ready Button (visible when data ready) -->
            <button class="firstload-ready-btn" id="firstload-ready-btn" style="display: none;">
                üöÄ Ir al Dashboard
            </button>
        </div>
    </div>

    <div class="header">
        <!-- Title with AppSwitcher -->
        <div style="display: flex; align-items: center; justify-content: center; gap: 12px;">
            <!-- AppSwitcher Button -->
            <div id="app-switcher" style="position: relative;">
                <button id="app-switcher-btn" onclick="toggleAppSwitcher()" style="padding: 8px; border-radius: 8px; border: none; background: rgba(255,255,255,0.15); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.2s;" onmouseenter="this.style.background='rgba(255,255,255,0.25)'" onmouseleave="this.style.background=document.getElementById('app-switcher-menu').style.display==='block'?'rgba(255,255,255,0.25)':'rgba(255,255,255,0.15)'" aria-label="Switch application">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="7" height="7" x="3" y="3" rx="1"></rect>
                        <rect width="7" height="7" x="14" y="3" rx="1"></rect>
                        <rect width="7" height="7" x="14" y="14" rx="1"></rect>
                        <rect width="7" height="7" x="3" y="14" rx="1"></rect>
                    </svg>
                </button>
                <!-- Dropdown Menu -->
                <div id="app-switcher-menu" style="display: none; position: absolute; top: 100%; left: 0; margin-top: 8px; width: 280px; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); border: 1px solid #e2e8f0; z-index: 1000; text-align: left;">
                    <div style="padding: 10px 14px; border-bottom: 1px solid #f1f5f9;">
                        <p style="font-size: 11px; font-weight: 600; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.05em; margin: 0;">TheAIPipe Tools</p>
                    </div>
                    <div style="padding: 6px 0;">
                        <!-- Imagen -->
                        <a id="app-link-imagen" href="#" style="display: flex; align-items: center; gap: 12px; padding: 10px 12px; margin: 0 6px; border-radius: 8px; text-decoration: none; background: transparent; transition: background 0.2s;" onmouseenter="this.style.background='#f8fafc'" onmouseleave="this.style.background='transparent'">
                            <div style="padding: 8px; border-radius: 8px; background: #dbeafe;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
                            </div>
                            <div style="flex: 1;">
                                <span style="font-weight: 500; color: #334155; font-size: 14px;">Imagen</span>
                                <p style="font-size: 12px; color: #64748b; margin: 2px 0 0 0;">Generaci√≥n de im√°genes</p>
                            </div>
                        </a>
                        <!-- Insights (current) -->
                        <div style="display: flex; align-items: center; gap: 12px; padding: 10px 12px; margin: 0 6px; border-radius: 8px; background: #f1f5f9; cursor: default;">
                            <div style="padding: 8px; border-radius: 8px; background: #d1fae5;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#059669" stroke-width="2"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg>
                            </div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-weight: 500; color: #0f172a; font-size: 14px;">Insights</span>
                                    <span style="font-size: 10px; background: #e2e8f0; color: #64748b; padding: 2px 6px; border-radius: 4px; font-weight: 500;">actual</span>
                                </div>
                                <p style="font-size: 12px; color: #64748b; margin: 2px 0 0 0;">Analytics Meta Ads</p>
                            </div>
                        </div>
                        <!-- Scriptwriter -->
                        <a id="app-link-scriptwriter" href="#" style="display: flex; align-items: center; gap: 12px; padding: 10px 12px; margin: 0 6px; border-radius: 8px; text-decoration: none; background: transparent; transition: background 0.2s;" onmouseenter="this.style.background='#f8fafc'" onmouseleave="this.style.background='transparent'">
                            <div style="padding: 8px; border-radius: 8px; background: #f3e8ff;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#9333ea" stroke-width="2"><path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg>
                            </div>
                            <div style="flex: 1;">
                                <span style="font-weight: 500; color: #334155; font-size: 14px;">Scriptwriter</span>
                                <p style="font-size: 12px; color: #64748b; margin: 2px 0 0 0;">Investigaci√≥n + Scripts</p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
            <!-- Insights Logo Icon -->
            <div style="background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%); padding: 6px; border-radius: 8px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3);">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" x2="12" y1="20" y2="10"></line>
                    <line x1="18" x2="18" y1="20" y2="4"></line>
                    <line x1="6" x2="6" y1="20" y2="16"></line>
                </svg>
            </div>
            <h1 data-i18n="dashboard.header_title">Insights Dashboard</h1>
            <!-- Language Selector -->
            <div id="lang-selector" style="position: relative; margin-left: 12px;">
                <button id="lang-btn" onclick="toggleLangMenu()" style="padding: 6px 10px; border-radius: 6px; border: none; background: rgba(255,255,255,0.15); cursor: pointer; display: flex; align-items: center; gap: 6px; transition: background 0.2s; color: white; font-size: 13px;" onmouseenter="this.style.background='rgba(255,255,255,0.25)'" onmouseleave="this.style.background=document.getElementById('lang-menu').style.display==='block'?'rgba(255,255,255,0.25)':'rgba(255,255,255,0.15)'">
                    <span id="current-lang-flag">üá™üá∏</span>
                    <span id="current-lang-code" style="text-transform: uppercase;">ES</span>
                </button>
                <div id="lang-menu" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 6px; width: 140px; background: white; border-radius: 8px; box-shadow: 0 8px 30px rgba(0,0,0,0.15); border: 1px solid #e2e8f0; z-index: 1000; text-align: left; overflow: hidden;">
                    <button onclick="switchLang('es')" style="width: 100%; padding: 10px 14px; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 14px; color: #334155; transition: background 0.15s;" onmouseenter="this.style.background='#f1f5f9'" onmouseleave="this.style.background='transparent'">
                        <span>üá™üá∏</span> Espa√±ol
                    </button>
                    <button onclick="switchLang('en')" style="width: 100%; padding: 10px 14px; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 14px; color: #334155; transition: background 0.15s;" onmouseenter="this.style.background='#f1f5f9'" onmouseleave="this.style.background='transparent'">
                        <span>üá¨üáß</span> English
                    </button>
                    <button onclick="switchLang('nl')" style="width: 100%; padding: 10px 14px; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 14px; color: #334155; transition: background 0.15s;" onmouseenter="this.style.background='#f1f5f9'" onmouseleave="this.style.background='transparent'">
                        <span>üá≥üá±</span> Nederlands
                    </button>
                    <button onclick="switchLang('da')" style="width: 100%; padding: 10px 14px; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 14px; color: #334155; transition: background 0.15s;" onmouseenter="this.style.background='#f1f5f9'" onmouseleave="this.style.background='transparent'">
                        <span>üá©üá∞</span> Dansk
                    </button>
                </div>
            </div>
        </div>
        <p><span data-i18n="dashboard.header_subtitle">An√°lisis de rendimiento creativo ‚Ä¢ √öltima actualizaci√≥n:</span> <span id="data-date" data-i18n="dashboard.loading">Cargando...</span></p>
        
        <div class="period-selector">
            <button class="period-btn" onclick="switchPeriod(this, 3)" data-i18n="dashboard.periods.3d">3 d√≠as</button>
            <button class="period-btn active" onclick="switchPeriod(this, 7)" data-i18n="dashboard.periods.7d">7 d√≠as</button>
            <button class="period-btn" onclick="switchPeriod(this, 14)" data-i18n="dashboard.periods.14d">14 d√≠as</button>
            <button class="period-btn" onclick="switchPeriod(this, 30)" data-i18n="dashboard.periods.30d">30 d√≠as</button>
            <button class="period-btn" onclick="switchPeriod(this, 90)" data-i18n="dashboard.periods.90d">90 d√≠as</button>
        </div>

        <div class="account-selector" style="margin-top:15px; display:flex; justify-content:center; gap:8px; align-items:center;">
            <div class="custom-dropdown" style="position: relative;">
                <button id="account-dropdown-btn" class="dropdown-btn" style="background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); color: white; padding: 10px 20px; padding-right: 35px; border-radius: 25px; cursor: pointer; font-weight: 600; font-size: 14px; min-width: 150px; max-width: 280px; outline: none; text-align: center; position: relative;">
                    <span id="account-dropdown-text" data-i18n="dashboard.accounts.all">Todas las cuentas</span>
                    <svg style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); transition: transform 0.3s;" width="12" height="12" viewBox="0 0 20 20" fill="white">
                        <path d="M10 12L6 8h8z"/>
                    </svg>
                </button>
                <div id="account-dropdown-menu" class="dropdown-menu" style="display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 5px; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); max-height: 400px; overflow-y: auto; z-index: 1000;">
                    <!-- Options will be added dynamically -->
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-content">
                    <h3>1609</h3>
                    <p>Anuncios con Inversi√≥n</p>
                </div>
                <div class="kpi-icon blue">üìä</div>
            </div>
            
            <div class="kpi-card">
                <div class="kpi-content">
                    <h3>$1,569,802</h3>
                    <p>Inversi√≥n Total</p>
                </div>
                <div class="kpi-icon green">üí∞</div>
            </div>
            
            <div class="kpi-card">
                <div class="kpi-content">
                    <h3 id="kpi-roas-value">3.42</h3>
                    <p id="kpi-roas-label">ROAS Promedio</p>
                </div>
                <div class="kpi-icon purple">üìà</div>
            </div>
            
            <div class="kpi-card">
                <div class="kpi-content">
                    <h3 id="kpi-extra-value">$0</h3>
                    <p id="kpi-extra-label">Valor de Conversi√≥n</p>
                </div>
                <div class="kpi-icon yellow">üíµ</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-content">
                    <h3 id="kpi-cpa-value">$0</h3>
                    <p id="kpi-cpa-label">CPA Promedio</p>
                </div>
                <div class="kpi-icon yellow">üéØ</div>
            </div>
        </div>
        
        <div class="chart-grid">
            <div class="chart-card fixed-height">
                <h3>üí∞ Top 5 Cuentas por Inversi√≥n</h3>
                <div class="bar-chart">
                    <div class="bar" style="height: 100.0%">
                        <span class="bar-value">$236k</span>
                        <span class="bar-label">Chabacano </span>
                    </div>
                    <div class="bar" style="height: 63.65769961648871%">
                        <span class="bar-value">$150k</span>
                        <span class="bar-label">VITDAYMX</span>
                    </div>
                    <div class="bar" style="height: 50.73332220430585%">
                        <span class="bar-value">$120k</span>
                        <span class="bar-label">Charm Fact</span>
                    </div>
                    <div class="bar" style="height: 40.22805222606504%">
                        <span class="bar-value">$95k</span>
                        <span class="bar-label">PUBLICIDAD</span>
                    </div>
                    <div class="bar" style="height: 36.15435836867869%">
                        <span class="bar-value">$85k</span>
                        <span class="bar-label">Entiii</span>
                    </div>
                </div>
            </div>
            
            <div class="chart-card fixed-height">
                <h3 data-i18n="dashboard.charts.format_distribution">üìä Distribuci√≥n por Formato</h3>
                <div class="donut-chart">
                    <svg class="donut-svg" viewBox="0 0 180 180">
                        <circle cx="90" cy="90" r="60" fill="none" stroke="#667eea" 
                                stroke-width="30" stroke-dasharray="191 377" 
                                stroke-dashoffset="-0" transform="rotate(-90 90 90)"></circle>
                        <circle cx="90" cy="90" r="60" fill="none" stroke="#00a854" 
                                stroke-width="30" stroke-dasharray="128 377" 
                                stroke-dashoffset="-191" transform="rotate(-90 90 90)"></circle>
                        <circle cx="90" cy="90" r="60" fill="none" stroke="#7928ca" 
                                stroke-width="30" stroke-dasharray="49 377" 
                                stroke-dashoffset="-319" transform="rotate(-90 90 90)"></circle>
                        <circle cx="90" cy="90" r="60" fill="none" stroke="#86868b" 
                                stroke-width="30" stroke-dasharray="9 377" 
                                stroke-dashoffset="-368" transform="rotate(-90 90 90)"></circle>
                        <circle cx="90" cy="90" r="30" fill="white"></circle>
                    </svg>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #667eea"></div>
                            <span>VIDEO (816) ‚Ä¢ ROAS: 2.85</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #00a854"></div>
                            <span>IMAGE (547) ‚Ä¢ ROAS: 3.24</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #7928ca"></div>
                            <span>INSTAGRAM (207) ‚Ä¢ ROAS: 3.76</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #86868b"></div>
                            <span>OTROS (39)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main-table-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <h2 id="table-title">Top 10 Anuncios por ROAS</h2>
                    <p data-i18n="dashboard.table.subtitle">Solo anuncios con inversi√≥n mayor a $3,000 MXN</p>
                </div>
                <button id="export-excel" class="export-btn" data-i18n="dashboard.table.export">
                    Exportar Excel
                </button>
            </div>

            <div class="table-container">
                <table id="ads-table">
                    <thead>
                    <tr>
                        <th data-i18n="dashboard.table.headers.ad">Anuncio</th>
                        <th data-i18n="dashboard.table.headers.status">Estado</th>
                        <th data-i18n="dashboard.table.headers.format">Formato</th>
                        <th data-i18n="dashboard.table.headers.start_date">Fecha Inicio</th>
                        <th data-i18n="dashboard.table.headers.amount_spent">Importe Gastado</th>
                        <th data-i18n="dashboard.table.headers.roas">ROAS</th>
                        <th data-i18n="dashboard.table.headers.cpa">CPA</th>
                        <th data-i18n="dashboard.table.headers.purchases">Compras</th>
                        <th data-i18n="dashboard.table.headers.awareness">Awareness</th>
                        <th data-i18n="dashboard.table.headers.type">Tipo</th>
                        <th data-i18n="dashboard.table.headers.angle">√Ångulo</th>
                        <th data-i18n="dashboard.table.headers.hook_type">Tipo de Hook</th>
                        <th data-i18n="dashboard.table.headers.view">Ver</th>
                        <th data-i18n="dashboard.table.headers.hypothesis">Hip√≥tesis</th>
                        <th data-i18n="dashboard.table.headers.learnings">Aprendizajes</th>
                        <th data-i18n="dashboard.table.headers.result">Resultado</th>
                    </tr>
                    <tr class="filter-row">
                        <th><input type="text" class="table-filter" data-column="0" data-i18n-placeholder="dashboard.table.filters.filter" placeholder="Filtrar..."></th>
                        <th>
                            <select class="table-filter" data-column="1">
                                <option value="" data-i18n="dashboard.table.filters.all">Todos</option>
                                <option value="active" data-i18n="dashboard.table.filters.active">Activo</option>
                                <option value="paused" data-i18n="dashboard.table.filters.paused">Pausado</option>
                            </select>
                        </th>
                        <th>
                            <select class="table-filter" data-column="2">
                                <option value="" data-i18n="dashboard.table.filters.all">Todos</option>
                                <option value="video">Video</option>
                                <option value="image">Image</option>
                                <option value="carousel">Carousel</option>
                                <option value="unknown">Otros</option>
                            </select>
                        </th>
                        <th><input type="date" class="table-filter" data-column="3"></th>
                        <th><input type="number" class="table-filter" data-column="4" placeholder="Min..."></th>
                        <th><input type="number" class="table-filter" data-column="5" placeholder="Min..." step="0.01"></th>
                        <th><input type="number" class="table-filter" data-column="6" placeholder="Max..." style="min-width: 65px;"></th>
                        <th><input type="number" class="table-filter" data-column="7" placeholder="Min..."></th>
                        <th>
                            <select class="table-filter" data-column="8">
                                <option value="">Todos</option>
                                <option value="unaware">Unaware</option>
                                <option value="problem">Problem</option>
                                <option value="solution">Solution</option>
                                <option value="product">Product</option>
                                <option value="most">Most Aware</option>
                            </select>
                        </th>
                        <th>
                            <select class="table-filter" data-column="9">
                                <option value="">Todos</option>
                                <option value="nuevo">Nuevo</option>
                                <option value="iteracion">Iteraci√≥n</option>
                            </select>
                        </th>
                        <th>
                            <select class="table-filter" data-column="10">
                                <option value="">Todos</option>
                            </select>
                        </th>
                        <th>
                            <select class="table-filter" data-column="11">
                                <option value="">Todos</option>
                                <option value="etiquetas">Etiquetas</option>
                                <option value="preguntas">Preguntas</option>
                                <option value="condicionales">Condicionales</option>
                                <option value="comandos">Comandos</option>
                                <option value="declaraciones">Declaraciones</option>
                                <option value="listas o pasos">Listas o Pasos</option>
                                <option value="narrativas">Narrativas</option>
                                <option value="exclamaciones / provocaciones">Exclamaciones / Provocaciones</option>
                            </select>
                        </th>
                        <th></th> <!-- 12: Ver (no filter) -->
                        <th></th> <!-- 13: Hip√≥tesis (no filter) -->
                        <th></th> <!-- 14: Aprendizajes (no filter) -->
                        <th>
                            <select class="table-filter" data-column="15">
                                <option value="">Todos</option>
                                <option value="ganador">Ganador</option>
                                <option value="perdedor">Perdedor</option>
                            </select>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dynamically populated by renderTable() -->
                </tbody>
            </table>
            </div>
        </div>
        
        <!-- TABLA EFICIENCIA POR FORMATO -->
        <div class="main-table-card">
            <h2 data-i18n="dashboard.efficiency_table.title">üìä Eficiencia por Tipo de Formato</h2>
            <p id="formato-subtitle" data-i18n="dashboard.efficiency_table.subtitle">An√°lisis comparativo de rendimiento por formato creativo</p>
            
            <table>
                <thead>
                    <tr>
                        <th>Formato</th>
                        <th>Cantidad</th>
                        <th>Inversi√≥n Total</th>
                        <th>ROAS Promedio</th>
                        <th>CPA</th>
                        <th>Compras</th>
                        <th>CTR Promedio</th>
                    </tr>
                </thead>
                <tbody id="formato-table">
                    <!-- Ser√° llenado por JavaScript -->
                </tbody>
            </table>
        </div>
        
        <!-- TABLA COMPARACI√ìN SEMANA A SEMANA -->
        <div class="main-table-card">
            <h2 data-i18n="dashboard.comparison_table.title">üìà Comparaci√≥n Semana a Semana</h2>
            <p id="comparison-dates">Comparaci√≥n entre semana actual (21-27 ago) vs semana anterior (14-20 ago)</p>

            <table>
                <thead>
                    <tr>
                        <th data-i18n="dashboard.comparison_table.headers.metric">M√©trica</th>
                        <th data-i18n="dashboard.comparison_table.headers.current_week">Semana Actual</th>
                        <th data-i18n="dashboard.comparison_table.headers.previous_week">Semana Anterior</th>
                        <th data-i18n="dashboard.comparison_table.headers.change">Cambio</th>
                    </tr>
                </thead>
                <tbody id="comparison-table">
                    <!-- Ser√° llenado por JavaScript -->
                </tbody>
            </table>
        </div>
        
        <!-- SECTION DEMOGRAPHICS -->
        <!-- SECTION NOMENCLATURA PETCARE -->
        <div class="preview-section" id="petcare-section" style="display: none;">
            
            <!-- √ÅNGULOS CREATIVOS -->
            <div class="chart-card" style="margin-bottom: 30px;">
                <h3>üìä √Ångulos Creativos - Petcare 2</h3>
                <p style="color: #86868b; font-size: 14px; margin-bottom: 20px;">An√°lisis basado en la nomenclatura de los anuncios</p>
                    <div class="bar-chart" id="petcare-angles-chart" style="padding-bottom: 80px; position: relative;">
                        <!-- Ordenados por spend (mayor a menor) -->
                        <!-- Picaz√≥n - Mayor spend -->
                        <div class="bar" style="height: 100%; background: linear-gradient(135deg, #ff9500 0%, #ff950099 100%);">
                            <span class="bar-value">$8.8K</span>
                            <span class="bar-roas" style="color: #ff9500">1.2 ‚ö†Ô∏è</span>
                            <span class="bar-label">Picaz√≥n</span>
                        </div>
                        <!-- Olor A Chetos -->
                        <div class="bar" style="height: 89%; background: linear-gradient(135deg, #ff3b30 0%, #ff3b3099 100%);">
                            <span class="bar-value">$7.9K</span>
                            <span class="bar-roas" style="color: #ff3b30">0.8 ‚ùå</span>
                            <span class="bar-label">Olor A Chetos</span>
                        </div>
                        <!-- Probi√≥ticos Baratos -->
                        <div class="bar" style="height: 81%; background: linear-gradient(135deg, #ff9500 0%, #ff950099 100%);">
                            <span class="bar-value">$7.2K</span>
                            <span class="bar-roas" style="color: #ff9500">1.5 ‚ö†Ô∏è</span>
                            <span class="bar-label">Probi√≥ticos Baratos</span>
                        </div>
                        <!-- Bienestar General -->
                        <div class="bar" style="height: 57%; background: linear-gradient(135deg, #00a854 0%, #00a85499 100%);">
                            <span class="bar-value">$5.0K</span>
                            <span class="bar-roas" style="color: #00a854">2.0 ‚úÖ</span>
                            <span class="bar-label">Bienestar General</span>
                        </div>
                        <!-- Restock -->
                        <div class="bar" style="height: 18%; background: linear-gradient(135deg, #00a854 0%, #00a85499 100%);">
                            <span class="bar-value">$1.6K</span>
                            <span class="bar-roas" style="color: #00a854">5.0 ‚úÖ</span>
                            <span class="bar-label">Restock</span>
                        </div>
                        <!-- Lamido de Patas -->
                        <div class="bar" style="height: 17%; background: linear-gradient(135deg, #00a854 0%, #00a85499 100%);">
                            <span class="bar-value">$1.5K</span>
                            <span class="bar-roas" style="color: #00a854">4.3 ‚úÖ</span>
                            <span class="bar-label">Lamido de Patas</span>
                        </div>
                        <!-- Problemas Digestivos -->
                        <div class="bar" style="height: 15%; background: linear-gradient(135deg, #00a854 0%, #00a85499 100%);">
                            <span class="bar-value">$1.3K</span>
                            <span class="bar-roas" style="color: #00a854">6.4 ‚úÖ</span>
                            <span class="bar-label">Problemas Digestivos</span>
                        </div>
                        <!-- Ansiedad - vraiment petit -->
                        <div class="bar" style="height: 3.2%; background: linear-gradient(135deg, #ff3b30 0%, #ff3b3099 100%);">
                            <span class="bar-value">$283</span>
                            <span class="bar-roas" style="color: #ff3b30">0.6 ‚ùå</span>
                            <span class="bar-label">Ansiedad</span>
                        </div>
                        <!-- Dolor Al Caminar - le plus petit -->
                        <div class="bar" style="height: 1.9%; background: linear-gradient(135deg, #00a854 0%, #00a85499 100%);">
                            <span class="bar-value">$171</span>
                            <span class="bar-roas" style="color: #00a854">7.8 ‚úÖ</span>
                            <span class="bar-label">Dolor Al Caminar</span>
                        </div>
                    </div>
            </div>
            
            <!-- PERFORMANCE POR CREADOR -->
            <div class="chart-card creators-card" style="margin-bottom: 30px;">
                <h3>üë• Performance por Creador</h3>
                <p style="color: #86868b; font-size: 14px; margin-bottom: 20px;">An√°lisis de rendimiento por creador de contenido</p>
                        <div class="creator-grid" id="petcare-creators-grid">
                            <div class="creator-card">
                                <div class="creator-avatar female">üë©</div>
                                <div class="creator-name">Melissa</div>
                                <div class="creator-stats">
                                    ROAS: <span class="creator-roas">2.1x</span><br>
                                    7 ads ‚Ä¢ $4.2K
                                </div>
                            </div>
                            <div class="creator-card">
                                <div class="creator-avatar male">üë®</div>
                                <div class="creator-name">Martin</div>
                                <div class="creator-stats">
                                    ROAS: <span class="creator-roas">1.1x</span><br>
                                    7 ads ‚Ä¢ $4.1K
                                </div>
                            </div>
                            <div class="creator-card">
                                <div class="creator-avatar" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">ü§ñ</div>
                                <div class="creator-name">Voz IA</div>
                                <div class="creator-stats">
                                    ROAS: <span class="creator-roas">1.0x</span><br>
                                    7 ads ‚Ä¢ $6.0K
                                </div>
                            </div>
                        </div>
            </div>
        </div>
        
        <!-- SECTION DEMOGRAPHICS (d√©plac√©e √† la fin) -->
        <div class="demographics-section" style="display: none; background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.07); margin-bottom: 30px;">
            <h2 style="margin-bottom: 10px;">üìä An√°lisis Demogr√°fico</h2>
            <p style="color: #86868b; margin-bottom: 15px; font-size: 14px;">Distribuci√≥n del gasto por edad y g√©nero</p>
            
            <!-- Auto-loading demographics content -->
            <div id="demographics-loaded">
                <div id="segments-distribution" style="margin-bottom: 15px;"></div>
                
                <div style="margin-top: 15px;">
                    <h3 style="font-size: 16px; margin-bottom: 12px;">Tabla Detallada por Segmento</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Segmento</th>
                                <th>Inversi√≥n</th>
                                <th>ROAS</th>
                                <th>CTR</th>
                                <th>CPA</th>
                                <th>Conversiones</th>
                            </tr>
                        </thead>
                        <tbody id="demographics-table">
                            <!-- Ser√° llenado din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Parser externe - dans docs pour GitHub Pages -->
    <script src="./scripts/shared/nomenclature_parser.js"></script>
    
    <script src="js/dashboard-app.js"></script>


    <!-- Welcome Modal (First-time onboarding) -->
    <div id="welcome-modal" class="welcome-modal-overlay">
        <div class="welcome-modal">
            <button class="welcome-modal-close" onclick="closeWelcomeModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <div class="welcome-modal-icon">üéâ</div>
            <h2>¬°Bienvenido a Insights!</h2>
            <p>Este dashboard te ayuda a analizar el rendimiento de tus creativos publicitarios en Meta Ads.</p>
            <div class="welcome-modal-features">
                <div class="welcome-feature">
                    <span class="welcome-feature-icon">üìä</span>
                    <span>M√©tricas de ROAS, CPA y conversiones</span>
                </div>
                <div class="welcome-feature">
                    <span class="welcome-feature-icon">üéØ</span>
                    <span>An√°lisis por √°ngulo y creador</span>
                </div>
                <div class="welcome-feature">
                    <span class="welcome-feature-icon">üìà</span>
                    <span>Comparaci√≥n semana a semana</span>
                </div>
            </div>
            <p class="welcome-modal-cta">¬øQuieres ver un tutorial de 19 minutos?</p>
            <div class="welcome-modal-buttons">
                <button class="welcome-btn-primary" onclick="watchWelcomeTutorial()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polygon points="10 8 16 12 10 16 10 8" fill="currentColor"></polygon>
                    </svg>
                    Ver Tutorial
                </button>
                <button class="welcome-btn-secondary" onclick="closeWelcomeModal()">
                    Explorar primero
                </button>
            </div>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div id="tutorial-modal" class="tutorial-modal-overlay" onclick="if(event.target === this) closeTutorialModal()">
        <div class="tutorial-modal">
            <div class="tutorial-modal-header">
                <h3 id="tutorial-modal-title">Tutorial</h3>
                <button class="tutorial-modal-close" onclick="closeTutorialModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="tutorial-modal-body">
                <iframe id="tutorial-modal-iframe" allow="autoplay; fullscreen" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <!-- TheAIPipe Config (centralized URLs) -->
    <script src="theaipipe-config.js"></script>

    <!-- AppSwitcher Script -->
    <script>
        // Initialize AppSwitcher URLs from config
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof THEAIPIPE_CONFIG !== 'undefined') {
                const imagenLink = document.getElementById('app-link-imagen');
                const scriptwriterLink = document.getElementById('app-link-scriptwriter');
                if (imagenLink) imagenLink.href = THEAIPIPE_CONFIG.urls.imagen;
                if (scriptwriterLink) scriptwriterLink.href = THEAIPIPE_CONFIG.urls.scriptwriter;
            }
        });

        function toggleAppSwitcher() {
            const menu = document.getElementById('app-switcher-menu');
            const btn = document.getElementById('app-switcher-btn');
            const isOpen = menu.style.display === 'block';
            menu.style.display = isOpen ? 'none' : 'block';
            btn.style.background = isOpen ? 'rgba(255,255,255,0.15)' : 'rgba(255,255,255,0.25)';
        }

        // Close AppSwitcher when clicking outside
        document.addEventListener('click', function(event) {
            const switcher = document.getElementById('app-switcher');
            const menu = document.getElementById('app-switcher-menu');
            if (switcher && menu && !switcher.contains(event.target)) {
                menu.style.display = 'none';
                document.getElementById('app-switcher-btn').style.background = 'rgba(255,255,255,0.15)';
            }
            // Also close language menu
            const langSelector = document.getElementById('lang-selector');
            const langMenu = document.getElementById('lang-menu');
            if (langSelector && langMenu && !langSelector.contains(event.target)) {
                langMenu.style.display = 'none';
            }
        });

        // Language Selector Functions
        function toggleLangMenu() {
            const menu = document.getElementById('lang-menu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        function switchLang(lang) {
            const url = new URL(window.location);
            url.searchParams.set('lang', lang);
            window.location.href = url.toString();
        }

        // Update language selector display on page load
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const currentLang = urlParams.get('lang') || 'es';
            const langFlags = { es: 'üá™üá∏', en: 'üá¨üáß', nl: 'üá≥üá±', da: 'üá©üá∞' };
            const flagEl = document.getElementById('current-lang-flag');
            const codeEl = document.getElementById('current-lang-code');
            if (flagEl) flagEl.textContent = langFlags[currentLang] || 'üá™üá∏';
            if (codeEl) codeEl.textContent = currentLang.toUpperCase();
        });
    </script>
</body>
</html>
<!-- Force cache refresh: 1756737899 -->
